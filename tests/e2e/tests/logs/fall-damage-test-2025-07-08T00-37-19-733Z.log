[LOG] Log file created: /mnt/d/claude/pixelAction/coin-hunter-adventure-pixel/tests/e2e/tests/logs/fall-damage-test-2025-07-08T00-37-19-733Z.log
[LOG] 
==================================================
[LOG] Starting test: Fall Damage Test
[LOG] Time: 2025-07-08T00:37:19.736Z
[LOG] ==================================================

[LOG] ðŸ’‰ Error tracking injected
[LOG] Navigating to: http://localhost:3000?s=0-3
[LOG] [Browser Console debug] [vite] connecting...
[LOG] [Browser Console debug] [vite] connected.
[LOG] [Browser Console log] Starting game initialization...
[LOG] [Browser Console log] Initializing GameCore...
[LOG] [Browser Console log] GameCore: init() started
[LOG] [Browser Console log] GameCore: Initializing ResourceLoader...
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/index.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/sprites.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/characters.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/audio.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/objects.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/bgm/title.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/physics.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/bgm/game.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/bgm/victory.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/bgm/gameover.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/se/coin.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/se/jump.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/se/damage.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/se/button.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/se/gameStart.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/se/goal.json
[LOG] [Browser Console log] [ResourceLoader] Using bundled data for: /src/config/resources/se/enemyDefeat.json
[LOG] [Browser Console log] GameCore: Registering core services...
[LOG] [Browser Console log] [PhysicsSystem] Initialized with:
[LOG] [Browser Console log]   - Gravity: 0.65
[LOG] [Browser Console log]   - Max fall speed: 15
[LOG] [Browser Console log]   - Friction: 0.8
[LOG] [Browser Console log] GameCore: Registering systems...
[LOG] [Browser Console log] GameCore: Initializing MusicSystem...
[LOG] [Browser Console log] MusicSystem: init() called
[LOG] [Browser Console log] MusicSystem: AudioContext created
[LOG] [Browser Console log] MusicSystem: AudioContext is suspended, attempting to resume...
[LOG] [Browser Console warn] The AudioContext was not allowed to start. It must be resumed (or created) after a user gesture on the page. https://developer.chrome.com/blog/autoplay/#web_audio
[LOG] âœ… Page loaded
[LOG] Waiting for game initialization...
[LOG] Game object exists: true
[LOG] [Browser Console warn] GameCore: MusicSystem initialization failed, continuing without audio: JSHandle@error
[LOG] [Browser Console log] GameCore: Registering states...
[LOG] [Browser Console log] GameCore: Initializing debug overlay...
[LOG] [Browser Console log] DebugOverlay Initialized with stage: stage0-3 (index: 5)
[LOG] [Browser Console log] GameCore: Hiding loading screen...
[LOG] [Browser Console log] GameCore: init() completed
[LOG] [Browser Console log] Starting game loop...
[LOG] [Browser Console log] GameCore: Starting game loop...
[LOG] [Browser Console log] GameCore: Game loop started, running: true
[LOG] [Browser Console log] GameCore: Initial state set to menu
[LOG] [Browser Console log] Game started successfully
[LOG] âœ… Game initialized
[LOG] [Browser Console log] InputSystemAdapter: update called
[LOG] [Browser Console log] MenuState update called, optionsAlpha: 0
[LOG] ðŸ“¸ Screenshot saved: Fall Damage Test-test-initialized-2025-07-08T00-37-27-527Z.png
[LOG] Starting new game...
[LOG] Waiting for state: menu...
[LOG] âœ… State changed to: menu
[LOG] Waiting for menu to appear...
[LOG] Waiting for menu fade in...
[LOG] âœ… menu fade in met
[LOG] Clicking at: (100, 100)
[LOG] Pressing key: Space (down/up with delay)
[LOG] [Browser Console log] InputSystem: Space key pressed, actions: JSHandle@array
[LOG] [Browser Console log] MenuState Environment: PRODUCTION, Stage progression: ENABLED
[LOG] [Browser Console log] MenuState Starting stage: stage0-3 (source: debug overlay
[LOG] [Browser Console log] [PlayState] enter() called with params: JSHandle@object
[LOG] [Browser Console log] [PlayState] Starting initialization...
[LOG] [Browser Console log] [PlayState] Stage progression: ENABLED
[LOG] [Browser Console log] [PlayState] Checking/loading sprites...
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/idle
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/walk1
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/jump1
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/idle_small
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/walk_small1
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/jump_small1
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: terrain/spring
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: terrain/goal_flag
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: items/coin_spin1
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: enemies/slime_idle1
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: enemies/bird_fly1
[LOG] [Browser Console log] [AssetLoader] Loaded sprite player/idle in 2.40ms
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/walk2
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/jump2
[LOG] [Browser Console log] [AssetLoader] Loaded sprite player/idle_small in 2.10ms
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/walk_small2
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/jump_small2
[LOG] [Browser Console log] [AssetLoader] Loaded sprite terrain/spring in 2.30ms
[LOG] [Browser Console log] [AssetLoader] Loaded sprite terrain/goal_flag in 2.60ms
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: items/coin_spin2
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: enemies/slime_idle2
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: enemies/bird_fly2
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/walk3
[LOG] [Browser Console log] [AssetLoader] Loaded animation player/jump (2 frames) in 3.90ms
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/walk_small3
[LOG] [Browser Console log] [AssetLoader] Loaded animation player/jump_small (2 frames) in 4.20ms
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: items/coin_spin3
[LOG] [Browser Console log] [AssetLoader] Loaded animation enemies/slime_idle (2 frames) in 4.70ms
[LOG] [Browser Console log] [AssetLoader] Loaded animation enemies/bird_fly (2 frames) in 5.00ms
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/walk4
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: player/walk_small4
[LOG] [Browser Console log] [SpriteLoader] Using bundled data for: items/coin_spin4
[LOG] [Browser Console log] [AssetLoader] Loaded animation player/walk (4 frames) in 7.60ms
[LOG] [Browser Console log] [AssetLoader] Loaded animation player/walk_small (4 frames) in 8.50ms
[LOG] [Browser Console log] [AssetLoader] Loaded animation items/coin_spin (4 frames) in 9.10ms
[LOG] [Browser Console log] [PlayState] Sprites loaded successfully in 10.90ms
[LOG] [Browser Console log] [LevelLoader] Using bundled data for: /src/levels/data/stages.json
[LOG] [Browser Console log] [LevelLoader] Using bundled data for: /src/levels/data/stage0-3.json
[LOG] [Browser Console log] [EntityManager] Creating player at (32, 160)
[LOG] [Browser Console log] [Player] Jump Configuration Debug:
[LOG] [Browser Console log]   - Config source: physics.json
[LOG] [Browser Console log]   - jumpPower: 10
[LOG] [Browser Console log]   - variableJumpBoost: 
[LOG] [Browser Console log]   - variableJumpBoostMultiplier: 
[LOG] [Browser Console log]   - minJumpTime: 0
[LOG] [Browser Console log]   - maxJumpTime: 400
[LOG] [Browser Console log]   - airResistance: 0
[LOG] [Browser Console log]   - gravityScale: 1
[LOG] [Browser Console log]   - maxFallSpeed: 10
[LOG] [Browser Console log] [EntityManager] Player created: success
[LOG] [Browser Console log] Enemy Created at x=150, y=180
[LOG] [Browser Console log] Enemy Created at x=200, y=100
[LOG] [Browser Console log] [PlayState] levelData: JSHandle@object
[LOG] [Browser Console log] [PlayState] levelData.name: STAGE 0-3
[LOG] [Browser Console log] [PlayState] Stage name set to: STAGE 0-3
[LOG] [Browser Console log] [PlayState] MusicSystem status: JSHandle@object
[LOG] [Browser Console log] [PlayState] Player created successfully
[LOG] [Browser Console log] PlayState ready event received: JSHandle@object
[LOG] [Browser Console log] [PlayState] enter() completed in 17.40ms
[LOG] [Browser Console log] [Player] Jump initiated:
[LOG] [Browser Console log]   - Initial Y position: 144
[LOG] [Browser Console log]   - Jump power applied: 12.1
[LOG] [Browser Console log]   - Initial velocity (vy): -12.1
[LOG] [Browser Console log]   - Air resistance: 0.13
[LOG] [Browser Console log]   - Gravity scale: 1
[LOG] [Browser Console log] [Player] Jump button released at time: 290.63333333477294 ms, velocity reduced from -10.780796400034568 to -5.390398200017284
[LOG] [Browser Console log] [Player] Jump completed:
[LOG] [Browser Console log]   - Final max height reached: 59.63218074090027 pixels
[LOG] [Browser Console log]   - Jump duration: 559.033333339813 ms
[LOG] Waiting for state: play...
[LOG] âœ… State changed to: play
[LOG] Waiting for PlayState ready...
[LOG] âœ… PlayState ready met
[LOG] âœ… New game started and ready
[LOG] ðŸ“¸ Screenshot saved: Fall Damage Test-game-started-2025-07-08T00-37-29-698Z.png
[LOG] âœ… Assert: Current state is 'play'
[LOG] âœ… Assert: Player exists
[LOG] Initial player stats: [object Object]
[LOG] Initial lives: 3
[LOG] 
--- Test: Multiple Falls Until Game Over ---
[LOG] Fall attempt 1 - Current lives: 3
[LOG] [Browser Console log] [PlayState] Player fell! Instant death.
[LOG] [Browser Console log] [Test] Death event detected
[LOG] [Browser Console log] [PlayState] handlePlayerDeath: lives after decrement: 2
[LOG] [Browser Console log] [PlayState] Respawning player at: 2, 10
[LOG] [Browser Console log] [Player] respawn called at (32, 160)
[LOG] [Browser Console log] [Player] Dispatching window player:respawned event
[LOG] [Browser Console log] [Test] Respawn after death detected
[LOG] Fall 1 result: respawned
[LOG] Lives after fall 1: 2
[LOG] ðŸ“¸ Screenshot saved: Fall Damage Test-after-fall-1-2025-07-08T00-37-30-758Z.png
[LOG] Fall attempt 2 - Current lives: 2
[LOG] [Browser Console log] [PlayState] Player fell! Instant death.
[LOG] [Browser Console log] [Test] Death event detected
[LOG] [Browser Console log] [PlayState] handlePlayerDeath: lives after decrement: 1
[LOG] [Browser Console log] [PlayState] Respawning player at: 2, 10
[LOG] [Browser Console log] [Player] respawn called at (32, 160)
[LOG] [Browser Console log] [Player] Dispatching window player:respawned event
[LOG] [Browser Console log] [Test] Respawn after death detected
[LOG] Fall 2 result: respawned
[LOG] Lives after fall 2: 1
[LOG] ðŸ“¸ Screenshot saved: Fall Damage Test-after-fall-2-2025-07-08T00-37-31-656Z.png
[LOG] Fall attempt 3 - Current lives: 1
[LOG] [Browser Console log] [PlayState] Player fell! Instant death.
[LOG] [Browser Console log] [Test] Death event detected
[LOG] [Browser Console log] [PlayState] handlePlayerDeath: lives after decrement: 0
[LOG] [Browser Console log] [PlayState] No lives left, triggering game over
[LOG] [Browser Console log] Game Over!
[LOG] Fall 3 result: gameover
[LOG] Lives after fall 3: 0
[LOG] âœ… Game over triggered correctly after losing all lives
[LOG] 
--- Test 2: HUD Verification ---
[LOG] Final lives (internal): 0
[LOG] HUD data: [object Object]
[LOG] ðŸ“¸ Screenshot saved: Fall Damage Test-test-complete-2025-07-08T00-37-32-641Z.png
[LOG] âœ… No errors detected
[LOG] 
âœ… TEST PASSED

[LOG] 
==================================================
[LOG] Test completed in: 13.30s
[LOG] ==================================================


[LOG] Log file created: /mnt/d/claude/pixelAction/coin-hunter-adventure-pixel/tests/e2e/tests/logs/bat-comprehensive-test-2025-07-15_08-49-04-JST.log
[LOG] 
==================================================
[LOG] Starting test: Bat Comprehensive Test
[LOG] Time: 2025-07-15_08-49-04-JST (JST)
[LOG] ==================================================

[LOG] Test timeout set to: 30000ms
[LOG] Navigating to: http://localhost:3000?s=2-1&skip_title=true
[LOG] [Browser Console debug] [vite] connecting...
[LOG] [Browser Console log] [08:49:07.495] Starting game initialization...
[LOG] [Browser Console log] [08:49:07.495] Initializing GameCore...
[LOG] [Browser Console log] [08:49:07.495] GameCore: init() started
[LOG] [Browser Console log] [08:49:07.495] GameCore: Initializing ResourceLoader...
[LOG] [Browser Console log] [08:49:07.495] [ResourceLoader] Using bundled data for: /src/config/resources/index.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/sprites.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/characters.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/audio.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/objects.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/bgm/title.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/physics.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/bgm/game.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/bgm/victory.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/bgm/gameover.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/se/coin.json
[LOG] [Browser Console log] [08:49:07.496] [ResourceLoader] Using bundled data for: /src/config/resources/se/jump.json
[LOG] [Browser Console log] [08:49:07.497] [ResourceLoader] Using bundled data for: /src/config/resources/se/damage.json
[LOG] [Browser Console log] [08:49:07.497] [ResourceLoader] Using bundled data for: /src/config/resources/se/button.json
[LOG] [Browser Console log] [08:49:07.497] [ResourceLoader] Using bundled data for: /src/config/resources/se/gameStart.json
[LOG] [Browser Console log] [08:49:07.497] [ResourceLoader] Using bundled data for: /src/config/resources/se/goal.json
[LOG] [Browser Console log] [08:49:07.497] [ResourceLoader] Using bundled data for: /src/config/resources/se/enemyDefeat.json
[LOG] [Browser Console log] [08:49:07.497] GameCore: Registering core services...
[LOG] [Browser Console log] [08:49:07.498] [PhysicsSystem] Initialized with:
[LOG] [Browser Console log] [08:49:07.498]   - Gravity: 0.65
[LOG] [Browser Console log] [08:49:07.498]   - Max fall speed: 15
[LOG] [Browser Console log] [08:49:07.498]   - Friction: 0.8
[LOG] [Browser Console log] [08:49:07.498] GameCore: Registering systems...
[LOG] [Browser Console log] [08:49:07.498] GameCore: Initializing MusicSystem...
[LOG] [Browser Console log] [08:49:07.498] MusicSystem: init() called
[LOG] [Browser Console log] [08:49:07.562] MusicSystem: AudioContext created
[LOG] [Browser Console log] [08:49:07.562] MusicSystem: AudioContext is suspended, attempting to resume...
[LOG] [Browser Console warn] The AudioContext was not allowed to start. It must be resumed (or created) after a user gesture on the page. https://developer.chrome.com/blog/autoplay/#web_audio
[LOG] ✅ Page loaded
[LOG] Waiting for game initialization...
[LOG] [Browser Console debug] [vite] connected.
[LOG] Game object exists: true
[LOG] [Browser Console warn] [08:49:12.563] GameCore: MusicSystem initialization failed, continuing without audio: JSHandle@error
[LOG] [Browser Console log] [08:49:12.563] GameCore: Registering states...
[LOG] [Browser Console log] [08:49:12.564] Initialized optimized background: 40 clouds, 30 trees
[LOG] [Browser Console log] [08:49:12.564] [PlayState] Using optimized background renderer
[LOG] [Browser Console log] [08:49:12.564] GameCore: Initializing debug overlay...
[LOG] [Browser Console log] [08:49:12.566] [PerformanceMonitor] Initialized
[LOG] [Browser Console log] [08:49:12.566] [LevelLoader] Using bundled data for: /src/levels/data/stages.json
[LOG] [Browser Console log] [08:49:12.566] DebugOverlay Loaded 10 stages from stages.json
[LOG] [Browser Console log] [08:49:12.567] EnemySpawnDialog Initialized
[LOG] [Browser Console log] [08:49:12.568] DebugOverlay Initialized with stage: stage2-1 (index: 8)
[LOG] [Browser Console log] [08:49:12.568] GameCore: Hiding loading screen...
[LOG] [Browser Console log] [08:49:12.568] GameCore: init() completed
[LOG] [Browser Console log] [08:49:12.568] Starting game loop...
[LOG] [Browser Console log] [08:49:12.568] GameCore: Starting game loop...
[LOG] [Browser Console log] [08:49:12.568] GameCore: Game loop started, running: true
[LOG] [Browser Console log] [08:49:12.568] GameCore: Skipping title, starting directly with stage: stage2-1
[LOG] [Browser Console log] [08:49:12.568] [PlayState] enter() called with params: JSHandle@object
[LOG] [Browser Console log] [08:49:12.569] [PlayState] Starting initialization...
[LOG] [Browser Console log] [08:49:12.569] [PlayState] Checking/loading sprites...
[LOG] [Browser Console log] [08:49:12.569] [SpriteLoader] Using bundled data for: player/idle
[LOG] [Browser Console log] [08:49:12.569] [SpriteLoader] Using bundled data for: player/walk1
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: player/jump1
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: player/idle_small
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: player/walk_small1
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: player/jump_small1
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: terrain/spring
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: terrain/goal_flag
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: items/coin_spin1
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: enemies/slime_idle1
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: enemies/bird_fly1
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: enemies/bat_hang
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: enemies/bat_fly1
[LOG] [Browser Console log] [08:49:12.570] [SpriteLoader] Using bundled data for: enemies/bat_fly2
[LOG] [Browser Console log] [08:49:12.571] [SpriteLoader] Using bundled data for: environment/cloud1
[LOG] [Browser Console log] [08:49:12.571] [SpriteLoader] Using bundled data for: environment/cloud2
[LOG] [Browser Console log] [08:49:12.571] [SpriteLoader] Using bundled data for: environment/tree1
[LOG] [Browser Console log] [08:49:12.571] [SpriteLoader] Using bundled data for: tiles/ground
[LOG] [Browser Console log] [08:49:12.571] [SpriteLoader] Using bundled data for: tiles/grass_ground
[LOG] [Browser Console log] [08:49:12.571] Game started successfully
[LOG] [Browser Console log] [08:49:12.572] [AssetLoader] Loaded sprite player/idle in 2.60ms
[LOG] [Browser Console log] [08:49:12.572] [SpriteLoader] Using bundled data for: player/walk2
[LOG] [Browser Console log] [08:49:12.572] [SpriteLoader] Using bundled data for: player/jump2
[LOG] [Browser Console log] [08:49:12.572] [AssetLoader] Loaded sprite player/idle_small in 2.40ms
[LOG] [Browser Console log] [08:49:12.572] [SpriteLoader] Using bundled data for: player/walk_small2
[LOG] [Browser Console log] [08:49:12.572] [SpriteLoader] Using bundled data for: player/jump_small2
[LOG] [Browser Console log] [08:49:12.573] [AssetLoader] Loaded sprite terrain/spring in 2.60ms
[LOG] [Browser Console log] [08:49:12.573] [AssetLoader] Loaded sprite terrain/goal_flag in 2.80ms
[LOG] [Browser Console log] [08:49:12.573] [SpriteLoader] Using bundled data for: items/coin_spin2
[LOG] [Browser Console log] [08:49:12.573] [SpriteLoader] Using bundled data for: enemies/slime_idle2
[LOG] [Browser Console log] [08:49:12.573] [SpriteLoader] Using bundled data for: enemies/bird_fly2
[LOG] [Browser Console log] [08:49:12.573] [AssetLoader] Loaded sprite enemies/bat_hang in 2.80ms
[LOG] [Browser Console log] [08:49:12.573] [AssetLoader] Loaded sprite enemies/bat_fly1 in 2.90ms
[LOG] [Browser Console log] [08:49:12.574] [AssetLoader] Loaded sprite enemies/bat_fly2 in 3.00ms
[LOG] [Browser Console log] [08:49:12.574] [AssetLoader] Loaded sprite environment/cloud1 in 3.30ms
[LOG] [Browser Console log] [08:49:12.574] [AssetLoader] Loaded sprite environment/cloud2 in 3.90ms
[LOG] [Browser Console log] [08:49:12.575] [AssetLoader] Loaded sprite environment/tree1 in 4.60ms
[LOG] [Browser Console log] [08:49:12.575] [AssetLoader] Loaded sprite tiles/ground in 4.70ms
[LOG] [Browser Console log] [08:49:12.576] [AssetLoader] Loaded sprite tiles/grass_ground in 5.00ms
[LOG] [Browser Console log] [08:49:12.576] [SpriteLoader] Using bundled data for: player/walk3
[LOG] [Browser Console log] [08:49:12.577] [AssetLoader] Loaded animation player/jump (2 frames) in 6.90ms
[LOG] [Browser Console log] [08:49:12.577] [SpriteLoader] Using bundled data for: player/walk_small3
[LOG] [Browser Console log] [08:49:12.577] [AssetLoader] Loaded animation player/jump_small (2 frames) in 7.10ms
[LOG] [Browser Console log] [08:49:12.577] [SpriteLoader] Using bundled data for: items/coin_spin3
[LOG] [Browser Console log] [08:49:12.578] [AssetLoader] Loaded animation enemies/slime_idle (2 frames) in 7.40ms
[LOG] [Browser Console log] [08:49:12.578] [AssetLoader] Loaded animation enemies/bird_fly (2 frames) in 7.60ms
[LOG] [Browser Console log] [08:49:12.578] [SpriteLoader] Using bundled data for: player/walk4
[LOG] [Browser Console log] [08:49:12.578] [SpriteLoader] Using bundled data for: player/walk_small4
[LOG] [Browser Console log] [08:49:12.578] [SpriteLoader] Using bundled data for: items/coin_spin4
[LOG] [Browser Console log] [08:49:12.579] [AssetLoader] Loaded animation player/walk (4 frames) in 9.50ms
[LOG] [Browser Console log] [08:49:12.579] [AssetLoader] Loaded animation player/walk_small (4 frames) in 9.60ms
[LOG] [Browser Console log] [08:49:12.580] [AssetLoader] Loaded animation items/coin_spin (4 frames) in 9.80ms
[LOG] [Browser Console log] [08:49:12.580] [PlayState] Sprites loaded successfully in 11.30ms
[LOG] [Browser Console log] [08:49:12.580] [AssetLoader] Stage type set to: cave
[LOG] [Browser Console log] [08:49:12.580] [LevelLoader] Using bundled data for: /src/levels/data/stages.json
[LOG] [Browser Console log] [08:49:12.581] [LevelLoader] Using bundled data for: /src/levels/data/stage2-1.json
[LOG] [Browser Console warn] [08:49:12.581] [GameController] 警告: プレイヤーのスポーン位置(2, 11)の下に地面がありません
[LOG] [Browser Console log] [08:49:12.581] [EntityManager] Creating player at (32, 176)
[LOG] [Browser Console log] [08:49:12.582] [Player] Jump Configuration Debug:
[LOG] [Browser Console log] [08:49:12.582]   - Config source: physics.json
[LOG] [Browser Console log] [08:49:12.582]   - jumpPower: 10
[LOG] [Browser Console log] [08:49:12.582]   - variableJumpBoost: 
[LOG] [Browser Console log] [08:49:12.582]   - variableJumpBoostMultiplier: 
[LOG] [Browser Console log] [08:49:12.582]   - minJumpTime: 0
[LOG] [Browser Console log] [08:49:12.582]   - maxJumpTime: 400
[LOG] [Browser Console log] [08:49:12.582]   - airResistance: 0
[LOG] [Browser Console log] [08:49:12.582]   - gravityScale: 1
[LOG] [Browser Console log] [08:49:12.582]   - maxFallSpeed: 10
[LOG] [Browser Console log] [08:49:12.582] [EntityManager] Player created: success
[LOG] [Browser Console log] [08:49:12.583] [EntityManager] Creating bat at (240, 16)
[LOG] [Browser Console log] [08:49:12.583] [EntityManager] Creating bat at (480, 16)
[LOG] [Browser Console log] [08:49:12.583] [EntityManager] Creating bat at (720, 16)
[LOG] [Browser Console log] [08:49:12.583] [EntityManager] Creating bat at (960, 16)
[LOG] [Browser Console log] [08:49:12.583] [EntityManager] Creating bat at (1200, 16)
[LOG] [Browser Console log] [08:49:12.583] [EntityManager] Creating bat at (1440, 16)
[LOG] [Browser Console log] [08:49:12.583] [EntityManager] Creating bat at (1680, 16)
[LOG] [Browser Console log] [08:49:12.583] [EntityManager] Creating bat at (1920, 16)
[LOG] [Browser Console log] [08:49:12.584] [EntityManager] Creating bat at (2160, 16)
[LOG] [Browser Console log] [08:49:12.584] [EntityManager] Creating bat at (2400, 16)
[LOG] [Browser Console log] [08:49:12.584] [EntityManager] Creating bat at (2640, 16)
[LOG] [Browser Console log] [08:49:12.584] Enemy Created at x=400, y=176
[LOG] [Browser Console log] [08:49:12.584] [EntityManager] Creating slime at (400, 176)
[LOG] [Browser Console log] [08:49:12.584] [EntityManager] Physics system has tilemap: true
[LOG] [Browser Console log] [08:49:12.584] Enemy Created at x=880, y=176
[LOG] [Browser Console log] [08:49:12.584] [EntityManager] Creating slime at (880, 176)
[LOG] [Browser Console log] [08:49:12.585] [EntityManager] Physics system has tilemap: true
[LOG] [Browser Console log] [08:49:12.585] Enemy Created at x=1360, y=176
[LOG] [Browser Console log] [08:49:12.585] [EntityManager] Creating slime at (1360, 176)
[LOG] [Browser Console log] [08:49:12.585] [EntityManager] Physics system has tilemap: true
[LOG] [Browser Console log] [08:49:12.585] Enemy Created at x=1840, y=176
[LOG] [Browser Console log] [08:49:12.585] [EntityManager] Creating slime at (1840, 176)
[LOG] [Browser Console log] [08:49:12.585] [EntityManager] Physics system has tilemap: true
[LOG] [Browser Console log] [08:49:12.585] Enemy Created at x=2320, y=176
[LOG] [Browser Console log] [08:49:12.585] [EntityManager] Creating slime at (2320, 176)
[LOG] [Browser Console log] [08:49:12.585] [EntityManager] Physics system has tilemap: true
[LOG] [Browser Console warn] [08:49:12.585] [EntityManager] 警告: エンティティ(coin)のスポーン位置(67, 11)が地面の中です！
[LOG] [Browser Console log] [08:49:12.586] [PlayState] levelData: JSHandle@object
[LOG] [Browser Console log] [08:49:12.586] [PlayState] levelData.name: STAGE 2-1
[LOG] [Browser Console log] [08:49:12.586] [PlayState] Stage name set to: STAGE 2-1
[LOG] [Browser Console log] [08:49:12.586] [PlayState] MusicSystem status: JSHandle@object
[LOG] [Browser Console log] [08:49:12.586] [PlayState] Player created successfully
[LOG] [Browser Console log] [08:49:12.586] [PlayState] enter() completed in 18.00ms
[LOG] ✅ Game initialized
[LOG] ✅ Assert: Current state is 'play'
[LOG] Clicking at: (100, 100)
[LOG] [Browser Console log] [08:49:12.595] InputSystemAdapter: update called
[LOG] [Browser Console log] [08:49:12.596] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] [Browser Console log] [08:49:12.596] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] [Browser Console log] [08:49:12.596] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] [Browser Console log] [08:49:12.596] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] [Browser Console log] [08:49:12.597] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] [Browser Console log] [08:49:12.597] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] [Browser Console log] [08:49:12.597] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] [Browser Console log] [08:49:12.597] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] [Browser Console log] [08:49:12.597] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] [Browser Console log] [08:49:12.597] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] [Browser Console log] [08:49:12.597] [Bat] updateAI called, deltaTime=0.016666666666666666
[LOG] 
=== コウモリの総合テスト ===
[LOG] 
--- 1. コウモリの表示確認 ---
[LOG] コウモリの数: 11
[LOG] 最初のコウモリ: x=240, y=16
[LOG] animState: hang
[LOG] bat_hangスプライト読み込み: 失敗
[LOG] 
--- 2. 物理設定の確認 ---
[LOG] 物理設定: [object Object]
[LOG] 
--- 3. プレイヤー検知テスト ---
[LOG] [Browser Console log] [08:49:13.127] [Bat] Player detected at X distance 40, starting flight to the left
[LOG] [Browser Console log] [08:49:13.144] [Bat] Flying: flyTime=0.02, x=239.0, y=16.0, targetY=16.0, direction=-1
[LOG] 飛行中のコウモリ: 1/11
[LOG] 
--- 4. 放物線飛行パターンの確認 (3秒間) ---
[LOG] [Browser Console log] [08:49:13.661] [Bat] Flying: flyTime=0.53, x=208.0, y=43.9, targetY=57.0, direction=-1
[LOG] 0秒: x=181, y=128.2, targetY=155.2, progress=0.49%
[LOG] [Browser Console log] [08:49:14.161] [Bat] Flying: flyTime=1.03, x=178.0, y=137.5, targetY=150.6, direction=-1
[LOG] 0.5秒: x=151, y=73.2, targetY=54.4, progress=0.74%
[LOG] [Browser Console log] [08:49:14.678] [Bat] Flying: flyTime=1.55, x=147.0, y=62.3, targetY=45.2, direction=-1
[LOG] 1秒: x=121, y=20.2, targetY=16, progress=0.99%
[LOG] [Browser Console log] [08:49:15.128] [Bat] Reached left boundary, turning right
[LOG] [Browser Console log] [08:49:15.195] [Bat] Flying: flyTime=2.07, x=124.0, y=18.2, targetY=16.6, direction=1
[LOG] 1.5秒: x=149, y=38.2, targetY=49.6, progress=0.24%
[LOG] [Browser Console log] [08:49:15.712] [Bat] Flying: flyTime=2.58, x=155.0, y=50.4, targetY=65.0, direction=1
[LOG] 2秒: x=179, y=128.2, targetY=155.2, progress=0.49%
[LOG] [Browser Console log] [08:49:16.228] [Bat] Flying: flyTime=3.10, x=186.0, y=137.9, targetY=132.6, direction=1
[LOG] [Browser Console warn] [08:49:16.363] [MusicSystem] Cannot play SE 'damage' - system not initialized
[LOG] 2.5秒: x=210, y=70.4, targetY=52, progress=0.75%
[LOG] 
Y座標の移動範囲: 20.2 ～ 128.2 (移動距離: 107.99999999999999ピクセル)
[LOG] 期待される範囲: 16 ～ 160 (移動距離: 144ピクセル)
[LOG] 📸 Screenshot saved: Bat Comprehensive Test-bat-comprehensive-test-2025-07-15_08-49-16-JST.png
[LOG] 
--- 追加デバッグ情報 ---
[LOG] デバッグ情報: [object Object]
[LOG] 
✅ TEST PASSED

[LOG] 
==================================================
[LOG] Test completed in: 12.71s
[LOG] ==================================================


<!DOCTYPE html>
<html>
<head>
    <title>Debug Overlay Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #333;
            color: #fff;
            font-family: monospace;
        }
        #gameCanvas {
            display: block;
            background: #000;
            margin: 20px auto;
        }
        #log {
            background: #000;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            white-space: pre;
        }
    </style>
</head>
<body>
    <h1>Debug Overlay Test</h1>
    <canvas id="gameCanvas" width="768" height="720"></canvas>
    <div id="loadingScreen" style="display:none;">Loading...</div>
    <div id="log"></div>
    
    <script type="module">
        const log = document.getElementById('log');
        const originalLog = console.log;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            log.textContent += args.join(' ') + '\n';
            log.scrollTop = log.scrollHeight;
            originalLog.apply(console, args);
        };
        
        console.warn = function(...args) {
            log.textContent += '[WARN] ' + args.join(' ') + '\n';
            log.scrollTop = log.scrollHeight;
            originalWarn.apply(console, args);
        };
        
        import('../src/index.ts').then(() => {
            console.log('Game loaded');
            
            // F3キーを押してデバッグオーバーレイを表示
            setTimeout(() => {
                const event = new KeyboardEvent('keydown', { key: 'F3' });
                window.dispatchEvent(event);
                console.log('F3 key pressed');
                
                // ServiceLocatorの状態を確認
                if (window.game) {
                    console.log('Game exists');
                    if (window.game.serviceLocator) {
                        console.log('ServiceLocator exists');
                        const services = window.game.serviceLocator.services || window.game.serviceLocator._services;
                        if (services) {
                            console.log('Services:', Array.from(services.keys()));
                        }
                    }
                    
                    // 各システムの状態を確認
                    console.log('Checking systems...');
                    try {
                        const physics = window.game.serviceLocator.get('physics');
                        console.log('Physics:', physics ? 'found' : 'not found');
                        if (physics && physics.entities) {
                            console.log('Physics entities:', physics.entities.size);
                        }
                    } catch (e) {
                        console.log('Physics error:', e.message);
                    }
                    
                    try {
                        const renderer = window.game.serviceLocator.get('renderer');
                        console.log('Renderer:', renderer ? 'found' : 'not found');
                        if (renderer && renderer.getCameraPosition) {
                            console.log('Camera position:', renderer.getCameraPosition());
                        }
                    } catch (e) {
                        console.log('Renderer error:', e.message);
                    }
                    
                    try {
                        const input = window.game.serviceLocator.get('input');
                        console.log('Input:', input ? 'found' : 'not found');
                    } catch (e) {
                        console.log('Input error:', e.message);
                    }
                }
            }, 2000);
        });
    </script>
</body>
</html>
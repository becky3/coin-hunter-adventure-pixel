# ジャンプ台（Spring）動作テスト結果

## 実装した修正

1. **Entity基底クラスに一意なIDを追加**
   - `src/entities/Entity.js`
   - グローバルカウンターで各エンティティに一意なIDを付与
   
2. **PhysicsSystemに衝突状態追跡機能を追加**
   - `src/physics/PhysicsSystem.js`
   - `collisionPairs` Mapで衝突中のエンティティペアを管理
   - 初回衝突時のみ `onCollision` を呼び出し
   - 衝突が終了したペアは自動削除
   
3. **Springの再利用判定を改善**
   - `src/entities/Spring.js`
   - プレイヤーが接地している場合も考慮

## テスト結果

### 自動テストの問題点
- Puppeteerでの自動テストは、ワープ位置の調整が困難
- プレイヤーが意図しない位置に配置され、ゴールやコインと衝突してしまう

### 手動テストの推奨手順

1. 開発サーバーを起動
   ```bash
   npm run dev
   ```

2. ブラウザで http://localhost:3000 を開く

3. ゲームを開始（Enter）

4. 通常のプレイでジャンプ台まで移動
   - 右矢印キーで移動

5. ジャンプ台に乗って自動ジャンプを確認

6. 着地後、まだジャンプ台の上にいる場合
   - 再度自動的にジャンプするかを確認

## 期待される動作

- ジャンプ台に乗ると自動的に高くジャンプする
- 着地後、まだジャンプ台の上にいれば再度ジャンプする
- 一度離れて再度乗っても正しくジャンプする

## 技術的な詳細

### 衝突ペア管理の仕組み
- 例: Player(id=1)とSpring(id=5)が衝突
- ペアキー "1-5" を作成
- 初回衝突時: Mapに "1-5" を登録し、`onCollision` を呼ぶ
- 衝突継続中: "1-5" がMapに存在するので、`onCollision` は呼ばない
- 離れた時: "1-5" をMapから削除
- 再度衝突: "1-5" がMapに存在しないので、新たな衝突として `onCollision` を呼ぶ
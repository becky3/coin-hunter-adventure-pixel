# coin-hunter-adventure-pixel プロジェクトガイド

## 概要

SVGベースの「coin-hunter-adventure」をピクセルアート（Canvas）ベースに移植するプロジェクトです。

## 📚 ドキュメント

**プロジェクトの詳細なドキュメントは `docs/` にあります。**

GitHub Pages公開後は以下でアクセス可能になります：
<https://becky3.github.io/coin-hunter-adventure-pixel/>

ローカルで確認する場合：

- **ホーム**: `docs/index.md`
- **開発ガイド**: `docs/development/`
- **仕様書**: `docs/specifications/`

### 引き継ぎ資料

`handover-docs/` - 過去の作業詳細、解決した問題、学んだ教訓

## 作業ディレクトリ構成

```
/mnt/d/claude/pixelAction/
├── coin-hunter-adventure-pixel/  # メイン開発（Git管理）
└── old_project_achive/          # 参照用（読み取り専用）
    └── testAction/              # 元プロジェクト（SVG版）
```

## 開発時の重要事項

### Issueドリブン開発

このプロジェクトは**GitHub Issueドリブン**で開発を進めます：

- 作業の優先順位はGitHub Issueで管理されています
- 新しい作業を始める際は必ずGitHub Issueを確認してください

### 作業開始前に必ず確認

1. **このファイル（CLAUDE.md）** - プロジェクトの基本情報
2. **docs/** - 開発ガイドラインと仕様書

### 必須作業

1. **TodoList管理** - 作業開始時に必ずTodoListで計画を作成・管理
2. **内容の検証** - ドキュメントや引き継ぎ内容に疑問がある場合は、実装前に確認
3. **日付の確認** - ファイル作成時は必ず `date` コマンドで現在日付を確認してから命名
4. **動作確認** - テスト機能を活用しClaude自身で行う
5. **確認に必要なテストがない場合** - 新しいテストケースとして追加
6. **テストの組み方** - 既存のテストケースを参考にする

### 制限事項

- `old_project_achive/` は参照のみ（編集・コミット禁止）
- 不要なファイル作成を避ける（既存ファイル編集を優先）

### 移植方針

- ゲームロジックは元プロジェクトから再利用
- 描画部分のみCanvas APIに対応
- SVG操作 → Canvas描画への変換に注意

## 開発サーバー

**重要**: サーバー起動はユーザー側で行います（トークン消費を避けるため）

起動コマンド：

```bash
cd /mnt/d/claude/pixelAction/coin-hunter-adventure-pixel
npm run dev
```

アクセスURL: <http://localhost:3000/>

## Git運用ルール

### コミットの基本方針

1. **修正は新しいコミットとして追加する**
   - `git commit --amend` の多用は避ける
   - 特にリモートにプッシュ済みのコミットは書き換えない

2. **コミットメッセージは明確に**
   - 何を変更したか、なぜ変更したかを記載
   - 日本語での記載も可

3. **force pushは原則禁止**
   - どうしても必要な場合は理由を明確にする
   - 共有ブランチでは絶対に行わない

### プッシュ前の確認

1. **開発サーバーを起動** - `npm run dev` でサーバーを起動しておく
2. **動作確認** - ローカルで実際に動作することを確認

**自動チェック**: プッシュ時に以下が自動実行されます

- E2Eテスト（開発サーバー稼働時のみ）
- Lintチェック

### GitHub Copilotレビューへの対応

PRを作成すると、GitHub Copilotが自動的にコードレビューを行います。以下の点に注意：

1. **Low Confidence コメントの扱い**
   - Copilotは確信度の低い指摘も行うことがあります
   - 実際のコードを確認し、問題がない場合は対応不要です
   - 例：ドキュメントを削除してもメソッドが存在する場合の警告

2. **対応が必要な場合**
   - 明らかなバグや問題点の指摘
   - セキュリティ上の懸念
   - パフォーマンスの改善提案

3. **対応記録**
   - Copilotの指摘に対応した場合は、その内容をコミットメッセージに記載
   - 対応しない場合は、PRコメントで理由を説明

## 作業開始時の手順

**重要: 以下の手順を必ず順番通りに実行してください**

### 1. 最新の状態を取得

```bash
git checkout main
git pull origin main
```

### 2. GitHub Issueの確認と選択

```bash
gh issue list
gh issue view [選択したIssue番号]
```

### 3. 作業ブランチの作成

```bash
git checkout -b feature/[機能名]
# または
git checkout -b bugfix/[バグ名]
```

### 4. Issueに作業開始をコメント

```bash
gh issue comment [Issue番号] --body "作業を開始します。
ブランチ: feature/[機能名]"
```

### 5. TodoListの作成

作業内容に基づいてTodoWriteツールで作業計画を作成してください。

### 6. プロジェクト状況の確認

- `docs/` - 開発ガイドラインと仕様書
- `handover-docs/` - 過去の作業履歴と引き継ぎ事項

**重要**: 作業の優先順位はGitHub Issueによって管理されています。

## システムの重要な制限事項

### テキスト表示

- **大文字英語のみ対応**（A-Z, 0-9, 一部記号）
- 日本語、小文字は表示不可
- 詳細は `docs/resources/pixel-art.md` を参照

### レンダリング

- PixelRendererのメソッドを使用すること（drawRect, setCamera等）
- 直接ctx操作は避ける（スケーリングが適用されない）

### 座標系

- **エンティティのスポーン座標は左下基準**（足元の位置）
- ステージデータ（JSON）では左下座標で指定
- 物理エンジン内部では左上座標を使用（自動変換される）

### デバッグログ

- **Logger クラスを使用**（`src/utils/Logger.ts`）
  - `Logger.log()` - 通常のログ出力
  - `Logger.warn()` - 警告（常に表示）
  - `Logger.error()` - エラー（常に表示）
- **production環境では自動的に無効化**
- console.log の直接使用は避ける（Lint警告の原因）

### テスト実行

- E2Eテストは `npm test` で実行（全てのtest-*.cjsファイルが自動実行）
- 個別テスト: `npm run test:e2e -- tests/e2e/[テスト名].cjs`
- テストログは `tests/logs/` に自動保存される

#### テスト実行のコツ

- **個別実行を推奨**: 問題のあるテストを特定しやすい

  ```bash
  node tests/e2e/test-enemy-damage.cjs
  ```

- **ログ確認**: 最新のログファイルを確認

  ```bash
  ls -la tests/logs/ | tail -10
  ```

- **既知の問題**:
  - スプライト読み込み遅延 → バンドリングで解決済み
  - 敵の落下問題 → ジャンプロジック削除で解決済み

### 新しいE2Eテストを追加する際のルール

**重要**: 新しいテストを追加した際は、以下の作業を必ず行ってください：

1. **テストファイルの命名規則**
   - ファイル名: `test-[機能名].cjs`
   - 場所: `tests/e2e/` ディレクトリ
   - 例: `test-coin-collection.cjs`

2. **ドキュメントの更新（必須）**
   - `docs/development/testing.md` の「E2Eテストファイル一覧」表を更新
   - 新しいテストの情報（ファイル名、目的、主なテスト内容、実行時間）を追加

3. **自動実行について**
   - `test-` で始まる `.cjs` ファイルは自動的に `npm test` に含まれます
   - run-all-tests.cjs への手動登録は不要

4. **テストの品質基準**
   - 全てのテストが成功する必要があります（1つでも失敗すると全体が停止）
   - 既存のテストに影響を与えないよう注意
   - 適切な待機処理とエラーハンドリングを実装

## トラブルシューティング

具体的な問題と解決方法については以下を参照してください：

- `handover-docs/` - 過去に発生した問題と解決履歴

## 継続的改善のルール

### 積極的な提案を歓迎します

作業中に以下のような気づきがあれば、遠慮なく提案してください：

#### 1. 開発効率の改善

- より良いツールやライブラリの提案
- 繰り返し作業の自動化アイデア
- テスト方法の改善案
- デバッグ効率を上げる方法

#### 2. コード品質の向上

- より読みやすいコード構造の提案
- パフォーマンス最適化のアイデア
- エラーハンドリングの改善
- 技術的負債の解消方法

#### 3. ドキュメントの改善

- 説明が不足している部分の指摘
- より分かりやすい書き方の提案
- 新しいドキュメントの必要性
- 既存ドキュメントの統廃合案

#### 4. プロジェクト運営の改善

- Git運用フローの最適化
- Issue管理の改善案
- コミュニケーション方法の提案
- 作業プロセスの効率化

### 改善提案の方法

1. **小さな改善は即実行**
   - 明らかな改善は実装と同時に行う
   - ドキュメントの誤字修正なども積極的に

2. **大きな改善は相談**
   - アーキテクチャ変更など影響が大きい場合は提案として記載
   - 引き継ぎ資料に「改善提案」セクションを設ける

3. **実験的な試み**
   - 新しいアプローチを試すことを推奨
   - 失敗しても学びとして記録

### 改善の記録

- 実施した改善は引き継ぎ資料に記載
- 他の開発者も恩恵を受けられるように
- 「なぜその改善を行ったか」も明記

### 心構え

**「こうした方が良いのでは？」と思ったら、それは貴重な改善の機会です。**

- 現状に満足せず、常により良い方法を探す
- 小さな改善の積み重ねがプロジェクトを進化させる
- あなたの視点が新しい価値を生み出す

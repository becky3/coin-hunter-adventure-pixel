#!/bin/bash

# フルテストを実行してからプッシュするスクリプト
# pre-pushフックのタイムアウトを回避するため

echo "=========================================="
echo "📋 フルテストを実行してからプッシュします"
echo "=========================================="
echo ""

# 1. Lintチェック
echo "1️⃣ Lintチェックを実行中..."
npm run lint
if [ $? -ne 0 ]; then
    echo "❌ Lintエラーが検出されました"
    exit 1
fi
echo "✅ Lintチェック: PASS"
echo ""

# 2. フルE2Eテスト
echo "2️⃣ フルE2Eテストスイートを実行中..."
echo "⏱️  これには数分かかる場合があります..."
echo ""

npm test
if [ $? -ne 0 ]; then
    echo "❌ E2Eテストが失敗しました"
    exit 1
fi
echo "✅ E2Eテスト: PASS"
echo ""

# 3. プッシュ（フックをスキップ）
echo "3️⃣ プッシュを実行中..."
git push --no-verify "$@"

echo ""
echo "=========================================="
echo "✅ フルテストとプッシュが完了しました"
echo "=========================================="
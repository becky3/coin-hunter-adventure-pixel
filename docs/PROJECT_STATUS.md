# プロジェクト実装状況

最終更新: 2025-07-01

## 現在の実装状況

### ✅ 実装済み機能

#### コアシステム
- **Game.ts** - メインゲームクラス、ゲームループ管理
- **InputSystem.ts** - 入力処理（キーボード、マウス対応）
- **GameStateManager.ts** - ゲーム状態管理

#### レンダリング
- **PixelRenderer.ts** - Canvas描画ラッパー、スケーリング対応
- **pixelFont.ts** - ビットマップフォント（大文字英語のみ）
- **pixelArt.ts** - ピクセルアート描画ユーティリティ

#### 音楽・音響
- **MusicSystem.ts** - BGM、効果音の管理と再生

#### アセット管理
- **AssetLoader.ts** - スプライトデータの読み込み
- **spriteLoader.ts** - JSONスプライトのパース

#### デバッグ機能
- **DebugOverlay.ts** - デバッグ表示（速度調整のみ）
- **GameConstants.ts** - ゲーム全体の定数管理（速度倍率など）

#### ゲーム状態
- **MenuState.ts** - タイトル画面（完成）
- **PlayState.ts** - ゲームプレイ画面（基本実装のみ）
- **TestPlayState.ts** - デバッグ用プレイ画面

#### エンティティ
- **Entity.ts** - 基底クラス
- **Player.ts** - プレイヤーキャラクター（基本動作のみ）
- **Coin.ts** - コイン（アニメーション実装済み）

#### レベル管理
- **LevelLoader.ts** - レベルデータの読み込みと管理（完成）
- レベルデータ（tutorial.json, level1.json）

#### 物理システム
- **PhysicsSystem.ts** - 物理演算システム（完成）
- 重力・衝突判定の統合管理
- タイルとの衝突判定
- エンティティ間の衝突判定

#### 敵システム
- **Enemy.ts** - 敵基底クラス（完成）
- **Slime.ts** - スライム敵（完成）
  - パトロール移動
  - ジャンプアニメーション
  - プレイヤーとの衝突判定（踏みつけ対応）

### 🚧 実装中・未実装機能

#### 敵システム（追加）
- Bird（鳥）
- より複雑なAIパターン

#### アイテム・収集物
- Spring（ばね）- 未実装
- GoalFlag（ゴール旗）- 未実装
- パーティクルエフェクト - 未実装

#### UI/HUD
- スコア表示（基本のみ実装）
- ライフ表示（基本のみ実装）
- タイマー（基本のみ実装）
- アイテム取得エフェクト

#### ゲームフロー
- ステージ遷移
- ゲームオーバー画面
- リザルト画面
- セーブ/ロード機能

#### テスト機能
- **tests/index.html** - テストメニュー（2025-07-01追加）
- E2Eテスト（Puppeteer）
- マニュアルテスト各種

## 既知の問題

### 技術的制限
1. **テキスト表示**
   - 大文字英語のみ対応（A-Z, 0-9, 一部記号）
   - 日本語、小文字は非対応

2. **レンダリング**
   - 直接ctx操作するとスケーリングが適用されない
   - 必ずPixelRendererのメソッドを使用すること

### バグ・課題
- プレイヤーの衝突判定が簡易的
- レベルエディタが未実装
- パフォーマンス最適化が未実施

### 解決済みの問題
1. **ゲームが小さく表示される**
   - 原因：直接ctx操作をしている
   - 解決：PixelRendererのメソッドを使用

2. **レベルが読み込まれない**
   - 原因：パスの問題
   - 解決：basePathを確認（`/src/levels/data/`）

3. **ジャンプで画面外に飛ぶ**（2025-06-26解決）
   - 原因：物理演算のdeltaTime処理が不適切
   - 解決：フレームベースの計算に戻し、ジャンプ力を調整

4. **アニメーション中にキャラが消える**（2025-06-26解決）
   - 原因：存在しないスプライト/アニメーションを参照
   - 解決：フォールバック処理を追加

5. **敵が高速で画面外に飛んでいく**（2025-06-27解決）
   - 原因：移動速度が20ピクセル/フレーム（1200ピクセル/秒）と高すぎた
   - 解決：速度を0.5に調整、PhysicsSystemの更新順序を修正

6. **敵を踏んでもプレイヤーがダメージを受ける**（2025-06-27解決）
   - 原因：踏みつけ判定が不正確で、横からの衝突と区別できていなかった
   - 解決：前フレームの位置を考慮した判定に改善、無敵時間の単位をミリ秒に修正

7. **すべてのJavaScriptファイルをTypeScriptに移行**（2025-06-29完了）
   - 実施内容：プロジェクト全体のTypeScript移行を完了
   - 結果：型安全性の向上、IDEサポートの改善、コード品質の向上

8. **デバッグオーバーレイの表示問題**（2025-07-01部分対応）
   - 問題：Speed以外の統計情報が「-」と表示される
   - 対応：Speed以外の表示を削除して簡素化
   - 今後：表示更新ロジックの見直しが必要

## 参考資料

- 実装計画: `IMPLEMENTATION_ROADMAP.md`
- 技術仕様: `TECHNICAL_SPECIFICATION.md`
- 引き継ぎ資料: `handover-docs/`ディレクトリ
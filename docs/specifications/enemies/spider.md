---
layout: default
title: Spider（スパイダー）
parent: 敵キャラクター
grand_parent: 仕様書
---

# Spider（スパイダー）

## 概要

スパイダーは天井を這い回り、プレイヤーを検知すると糸を使って降下する敵キャラクターです。

## 仕様

### 基本ステータス

| 項目 | 値 |
|------|-----|
| サイズ | 16×16ピクセル |
| 体力 | 1 |
| ダメージ | 1 |
| 移動速度 | 0.3 |
| スコア | 150ポイント |

### 状態（SpiderState）

1. **crawling（這い回り）**
   - 天井を左右に巡回移動
   - 巡回範囲: 初期位置から左右60ピクセル
   - 天井Y座標: 初期Y座標を維持

2. **descending（降下）**
   - プレイヤーを検知すると糸で降下開始
   - 降下速度: 0.5
   - 最大糸長さ: 80ピクセル

3. **ascending（上昇）**
   - 待機後、糸を登って天井に戻る
   - 上昇速度: 0.5

4. **waiting（待機）**
   - 降下完了後、2秒間待機
   - この間もプレイヤーとの衝突判定は有効

### AI動作

#### プレイヤー検知
- 検知範囲: 水平方向100ピクセル
- 条件:
  - スパイダーが天井這い状態
  - プレイヤーがスパイダーの下方にいる
  - 水平距離が検知範囲内

#### 移動パターン
1. 天井這い時は左右に巡回
2. 壁に衝突すると方向転換
3. 降下・上昇時は垂直移動のみ

### 物理設定

- 重力: 無効（gravityScale = 0）
- 物理演算: 無効（physicsEnabled = false）
- 摩擦係数: 1.0

### アニメーション

| 状態 | スプライトキー | 説明 |
|------|---------------|------|
| 待機 | spider_idle | 静止状態 |
| 歩行 | spider_walk1, spider_walk2 | 2フレームアニメーション（150ms間隔） |
| 糸降下/上昇 | spider_thread | 糸にぶら下がった状態 |

### 実装クラス

- **クラス**: `Spider`（`src/entities/enemies/Spider.ts`）
- **親クラス**: `Enemy`
- **インターフェース**: `EntityInitializer`

### 特記事項

- 天井からの這い回りは現在「ceiling」表面のみ対応
- 壁面（wall_left, wall_right）や床（floor）への這い回りは実装済みだが未使用
- 糸の描画は実装されていない（スパイダー本体のみ表示）

## テスト

### E2Eテスト

`test-spider.cjs`で以下の項目をテスト：

1. スパイダーの生成と初期状態
2. 天井這い移動の動作
3. プレイヤー検知と降下開始
4. 糸降下の動作と最大長制限
5. ダメージ処理
6. 踏みつけによる撃破

### 手動テスト

1. デバッグオーバーレイ（Dキー）で敵生成ダイアログを開く
2. 「spider」を選択して天井付近に配置
3. プレイヤーをスパイダーの下に移動させて検知動作を確認
4. 降下・待機・上昇のサイクルを確認
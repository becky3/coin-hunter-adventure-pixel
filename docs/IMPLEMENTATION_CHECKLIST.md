# 実装チェックリスト

## 目的
単純な実装ミスを防ぎ、品質の高いコードを確実に実装するためのチェックリスト

## 新機能実装前のチェック

### 1. 依存関係の確認
- [ ] 使用するクラス/メソッドのインターフェースを確認
- [ ] 必要なメソッドが実装されているか確認
- [ ] パラメータの型と順序を確認
- [ ] 戻り値の型を確認

### 2. 既存コードの調査
```bash
# 例: hasSpriteメソッドを使う前に
grep -r "hasSprite" src/
grep -r "class.*Renderer" src/
```

### 3. インターフェースの確認
- [ ] 親クラスのメソッドを確認
- [ ] 使用するオブジェクトの公開メソッドを確認
- [ ] 必要に応じてメソッド一覧を作成

## 実装時のチェック

### 1. メソッド呼び出し
```javascript
// ❌ 悪い例: メソッドの存在を確認せずに呼び出す
if (!renderer.hasSprite(this.spriteKey)) {

// ✅ 良い例: 存在チェックまたはtry-catchを使用
if (renderer.hasSprite && !renderer.hasSprite(this.spriteKey)) {
// または
try {
    if (!renderer.hasSprite(this.spriteKey)) {
        // ...
    }
} catch (e) {
    // フォールバック処理
}
```

### 2. オプショナルチェイニング
```javascript
// ✅ 安全なプロパティアクセス
const sprite = this.game?.assetLoader?.sprites?.get(spriteKey);
```

### 3. デフォルト値の設定
```javascript
// ✅ デフォルト値で安全性を確保
const enemies = state.enemies || [];
const width = options.width ?? 16;
```

## 実装後のチェック

### 1. 基本動作確認
- [ ] `npm run lint` でエラーがないか確認
- [ ] 開発サーバーでエラーが出ないか確認
- [ ] コンソールにエラーが出ていないか確認

### 2. 影響範囲の確認
```bash
# 変更したメソッド/プロパティの使用箇所を確認
grep -r "methodName" src/
```

### 3. テスト実行
- [ ] 関連する手動テストHTMLで動作確認
- [ ] 基本的な操作（移動、ジャンプなど）が動作するか確認
- [ ] 新機能が期待通り動作するか確認

## よくある実装ミスと対策

### 1. 存在しないメソッドの呼び出し
**問題**: `renderer.hasSprite()` のような未実装メソッドを呼び出す
**対策**: 
- 使用前にメソッドの存在を確認
- APIドキュメントまたはソースコードを確認
- 型定義ファイルの活用（将来的に）

### 2. スプライトシステムの不整合
**問題**: PixelRendererとPixelArtRendererの混在
**対策**:
- 現在使用しているレンダラークラスを明確にする
- 統一的なインターフェースを定義
- 移行計画を文書化

### 3. 非同期処理のエラーハンドリング不足
**問題**: スプライト読み込みエラーでゲームが止まる
**対策**:
```javascript
// 必ずcatchを追加
assetLoader.loadSprite().catch(err => {
    console.warn('Sprite load failed:', err);
    // フォールバック処理
});
```

## 推奨される開発フロー

1. **調査フェーズ** (15分)
   - 関連ファイルの確認
   - 使用するAPIの確認
   - 既存の実装パターンの確認

2. **設計フェーズ** (10分)
   - インターフェースの定義
   - エラーケースの想定
   - フォールバック戦略の決定

3. **実装フェーズ**
   - 小さな単位で実装
   - 都度動作確認
   - エラーハンドリングの追加

4. **検証フェーズ**
   - lint実行
   - 手動テスト
   - 影響範囲の確認

## クイックチェックコマンド

```bash
# 実装前の確認
grep -r "className\|methodName" src/

# 実装後の確認
npm run lint
grep -r "修正したメソッド名" src/

# テスト実行
node tests/puppeteer/simple-test.js
```

## 今後の改善提案

1. **TypeScript導入**
   - 型チェックで実行前にエラーを検出
   - IDEの補完機能で実装ミスを防止

2. **単体テスト追加**
   - Jestなどでクラスメソッドをテスト
   - 回帰テストで既存機能の破壊を防止

3. **CI/CD強化**
   - プルリクエスト時の自動テスト
   - エラーの早期発見

4. **APIドキュメント生成**
   - JSDocからドキュメント自動生成
   - メソッド一覧の可視化
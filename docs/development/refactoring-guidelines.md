---
layout: default
title: リファクタリングガイドライン
parent: 開発ガイド
---

# リファクタリングガイドライン

## 概要

このドキュメントでは、コードのリファクタリング時に従うべきガイドラインを定めています。特に、古いコードの削除に関するルールを明確化しています。

## 古いコード削除のルール

### 1. リファクタリング時の必須チェック項目

リファクタリングを行う際は、以下の項目を必ずチェックしてください：

#### コード面
- [ ] 削除・変更した機能に関連する**すべてのコード**を削除
- [ ] 未使用のインポート文を削除
- [ ] 未使用の変数、関数、メソッド、クラスを削除
- [ ] コメントアウトされたコードを削除（履歴はGitで管理）
- [ ] 空実装のメソッドを削除（意図的なものは明確にコメント）
- [ ] 関連するインターフェース定義を更新・削除
- [ ] 設定ファイルから不要なパラメータを削除

#### ドキュメント面
- [ ] 削除した機能に関する記述をドキュメントから削除
- [ ] 変更内容を引き継ぎ資料に記録
- [ ] APIドキュメントを更新

### 2. TODOコメントの管理

#### TODOコメントを残す場合
- 具体的な実装予定がある
- Issueが作成されている
- 実装の優先順位が明確

#### TODOコメントを削除する場合
- 実装予定がない
- 機能自体が不要になった
- 代替手段で解決済み

### 3. デバッグコードの扱い

- `console.log`は削除（Loggerクラスを使用）
- デバッグ用の一時的なコードは削除
- 開発支援機能は`DebugOverlay`などに集約

### 4. 削除前の確認事項

1. **依存関係の確認**
   - 削除するコードを参照している箇所がないか確認
   - `grep`や`Glob`ツールを使用して徹底的に検索

2. **テストの実行**
   - `npm run lint`でエラーがないことを確認
   - E2Eテストが通ることを確認

3. **動作確認**
   - ローカルで実際に動作確認
   - 関連機能が正常に動作することを確認

### 5. コミット時の注意事項

- 削除内容を明確にコミットメッセージに記載
- 大規模な削除は別コミットとして分離
- なぜ削除したかの理由を記載

例：
```
fix: 未使用のノックバック機能を完全削除

- Enemy.tsからノックバック処理を削除
- ResourceConfig.tsからknockbackインターフェースを削除
- ノックバック機能は仕様変更により不要となったため
```

### 6. 定期的なクリーンアップ

- 月に1回は未使用コードの検査を実施
- `npm run lint`の警告を放置しない
- TODOコメントの棚卸しを実施

## 推奨ツール

### コード検索
```bash
# TODOコメントの検索
find src -name "*.ts" | xargs grep -n "TODO\|FIXME\|HACK"

# 未使用インポートの確認
npm run lint

# 特定の機能の使用箇所を検索
grep -r "functionName" src/
```

### 依存関係の確認
- VSCodeの「すべての参照を検索」機能
- TypeScriptコンパイラの未使用コード警告

## まとめ

リファクタリングは単に動作するコードを書き換えることではありません。**不要なコードを確実に削除**し、**ドキュメントを最新に保つ**ことで、将来のバグを防ぎ、開発効率を向上させます。

「後で削除する」ではなく、**「今削除する」**を心がけましょう。